<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard | Endevera Member Portal</title>
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect x='5' y='5' width='90' height='90' fill='none' stroke='%23c9a227' stroke-width='6'/><text x='50' y='68' font-family='Georgia,serif' font-size='55' font-weight='500' fill='%23c9a227' text-anchor='middle'>E</text></svg>">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@300;400;500;600;700&family=DM+Sans:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Shared Styles -->
    <link rel="stylesheet" href="/frontend/css/shared-styles.css">
    
    <!-- Portal Styles -->
    <link rel="stylesheet" href="/frontend/css/portal.css">
    
    <!-- Member Navigation -->
    <link rel="stylesheet" href="/frontend/components/nav-member/nav-member.css">
</head>
<body data-page-type="portal">

    <!-- Member Navigation Component (injected by component-loader) -->

    <div class="portal-page">
        <div class="portal-container">
            <!-- Header -->
            <div class="portal-header">
                <p class="portal-welcome" id="welcomeMessage">Loading...</p>
                <h1 class="portal-title">Investment Dashboard</h1>
                <p class="portal-subtitle">Overview of your portfolio and investment opportunities</p>
            </div>

            <!-- Stats Grid -->
            <div class="portal-stats" id="statsGrid">
                <!-- Stats loaded by JavaScript -->
            </div>

            <!-- Content Grid -->
            <div class="portal-content-grid">
                <!-- Left Column: Active Deals -->
                <div>
                    <div class="portal-card">
                        <div class="portal-card-header">
                            <h2 class="portal-card-title">My Active Investments</h2>
                            <a href="/frontend/portal/deals.html" class="portal-card-action">View All</a>
                        </div>
                        <div class="portal-card-body" id="activeDealsContainer">
                            <!-- Loaded by JavaScript -->
                        </div>
                    </div>

                    <div class="portal-card" style="margin-top: 30px;">
                        <div class="portal-card-header">
                            <h2 class="portal-card-title">Investment Opportunities</h2>
                            <a href="/frontend/portal/deals.html" class="portal-card-action">Browse All</a>
                        </div>
                        <div class="portal-card-body" id="availableDealsContainer">
                            <!-- Loaded by JavaScript -->
                        </div>
                    </div>
                </div>

                <!-- Right Column: Activity & Quick Links -->
                <div>
                    <div class="portal-card">
                        <div class="portal-card-header">
                            <h2 class="portal-card-title">Recent Activity</h2>
                            <a href="/frontend/portal/messages.html" class="portal-card-action">View All</a>
                        </div>
                        <div class="portal-card-body">
                            <div class="activity-list" id="activityList">
                                <!-- Loaded by JavaScript -->
                            </div>
                        </div>
                    </div>

                    <div class="portal-card" style="margin-top: 30px;">
                        <div class="portal-card-header">
                            <h2 class="portal-card-title">Quick Links</h2>
                        </div>
                        <div class="portal-card-body">
                            <div style="display: flex; flex-direction: column; gap: 15px;">
                                <a href="/frontend/portal/documents.html" style="display: flex; align-items: center; gap: 12px; padding: 15px; background: var(--color-charcoal); border: 1px solid var(--color-medium-gray); text-decoration: none; transition: var(--transition-fast);" onmouseover="this.style.borderColor='var(--color-gold)'" onmouseout="this.style.borderColor='var(--color-medium-gray)'">
                                    <div style="width: 40px; height: 40px; background: rgba(201, 162, 39, 0.1); border: 1px solid rgba(201, 162, 39, 0.3); display: flex; align-items: center; justify-content: center;">
                                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#c9a227" stroke-width="1.5">
                                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                                            <polyline points="14 2 14 8 20 8"/>
                                        </svg>
                                    </div>
                                    <div style="flex: 1;">
                                        <div style="font-size: 14px; font-weight: 500; color: var(--color-white); margin-bottom: 3px;">View Documents</div>
                                        <div style="font-size: 12px; color: var(--color-light-gray);">Access prospectuses & reports</div>
                                    </div>
                                </a>

                                <a href="/frontend/portal/messages.html" style="display: flex; align-items: center; gap: 12px; padding: 15px; background: var(--color-charcoal); border: 1px solid var(--color-medium-gray); text-decoration: none; transition: var(--transition-fast);" onmouseover="this.style.borderColor='var(--color-gold)'" onmouseout="this.style.borderColor='var(--color-medium-gray)'">
                                    <div style="width: 40px; height: 40px; background: rgba(201, 162, 39, 0.1); border: 1px solid rgba(201, 162, 39, 0.3); display: flex; align-items: center; justify-content: center;">
                                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#c9a227" stroke-width="1.5">
                                            <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/>
                                        </svg>
                                    </div>
                                    <div style="flex: 1;">
                                        <div style="font-size: 14px; font-weight: 500; color: var(--color-white); margin-bottom: 3px;">Messages</div>
                                        <div style="font-size: 12px; color: var(--color-light-gray);">View communications</div>
                                    </div>
                                </a>

                                <a href="/frontend/portal/reports.html" style="display: flex; align-items: center; gap: 12px; padding: 15px; background: var(--color-charcoal); border: 1px solid var(--color-medium-gray); text-decoration: none; transition: var(--transition-fast);" onmouseover="this.style.borderColor='var(--color-gold)'" onmouseout="this.style.borderColor='var(--color-medium-gray)'">
                                    <div style="width: 40px; height: 40px; background: rgba(201, 162, 39, 0.1); border: 1px solid rgba(201, 162, 39, 0.3); display: flex; align-items: center; justify-content: center;">
                                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#c9a227" stroke-width="1.5">
                                            <line x1="12" y1="20" x2="12" y2="10"/>
                                            <line x1="18" y1="20" x2="18" y2="4"/>
                                            <line x1="6" y1="20" x2="6" y2="16"/>
                                        </svg>
                                    </div>
                                    <div style="flex: 1;">
                                        <div style="font-size: 14px; font-weight: 500; color: var(--color-white); margin-bottom: 3px;">Portfolio Reports</div>
                                        <div style="font-size: 12px; color: var(--color-light-gray);">Quarterly performance reviews</div>
                                    </div>
                                </a>

                                <a href="/frontend/portal/profile.html" style="display: flex; align-items: center; gap: 12px; padding: 15px; background: var(--color-charcoal); border: 1px solid var(--color-medium-gray); text-decoration: none; transition: var(--transition-fast);" onmouseover="this.style.borderColor='var(--color-gold)'" onmouseout="this.style.borderColor='var(--color-medium-gray)'">
                                    <div style="width: 40px; height: 40px; background: rgba(201, 162, 39, 0.1); border: 1px solid rgba(201, 162, 39, 0.3); display: flex; align-items: center; justify-content: center;">
                                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#c9a227" stroke-width="1.5">
                                            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                                            <circle cx="12" cy="7" r="4"/>
                                        </svg>
                                    </div>
                                    <div style="flex: 1;">
                                        <div style="font-size: 14px; font-weight: 500; color: var(--color-white); margin-bottom: 3px;">My Profile</div>
                                        <div style="font-size: 12px; color: var(--color-light-gray);">Update account settings</div>
                                    </div>
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="/frontend/js/shared-script.js"></script>
    <script src="/frontend/js/component-loader-portal.js"></script>
    <script src="/frontend/js/mock-data.js"></script>
    <script src="/frontend/js/portal.js"></script>
    <script src="/frontend/components/nav-member/nav-member.js"></script>
    
    <!-- Dashboard Page Script -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Check authentication
            if (!PortalUtils.checkMemberAuth()) return;

            // Load dashboard data
            loadDashboard();
        });

        function loadDashboard() {
            const userData = PortalUtils.getMemberData();
            
            // Set welcome message
            const welcomeMessage = document.getElementById('welcomeMessage');
            if (welcomeMessage) {
                welcomeMessage.textContent = `Welcome back, ${userData.firstName}`;
            }

            // Load stats
            loadStats(userData);

            // Load active investments
            loadActiveDeals();

            // Load available opportunities
            loadAvailableDeals();

            // Load recent activity
            loadRecentActivity();
        }

        function loadStats(userData) {
            const statsGrid = document.getElementById('statsGrid');
            if (!statsGrid) return;

            const stats = [
                {
                    icon: '<path d="M12 2v20M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/>',
                    label: 'Total Invested',
                    value: PortalUtils.formatCurrency(userData.investmentTotal || 0)
                },
                {
                    icon: '<line x1="12" y1="20" x2="12" y2="10"/><line x1="18" y1="20" x2="18" y2="4"/><line x1="6" y1="20" x2="6" y2="16"/>',
                    label: 'Total Returns',
                    value: PortalUtils.formatCurrency(userData.totalReturns || 0),
                    change: '+7.4%',
                    positive: true
                },
                {
                    icon: '<rect x="2" y="7" width="20" height="14" rx="2" ry="2"/><path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"/>',
                    label: 'Active Investments',
                    value: userData.activeDeals || 0
                },
                {
                    icon: '<path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"/>',
                    label: 'Opportunities',
                    value: PortalUtils.getDeals().filter(d => d.status === 'active' && !d.userInvested).length
                }
            ];

            statsGrid.innerHTML = stats.map(stat => `
                <div class="stat-card">
                    <div class="stat-card-header">
                        <div class="stat-card-icon">
                            <svg viewBox="0 0 24 24">${stat.icon}</svg>
                        </div>
                    </div>
                    <div class="stat-card-label">${stat.label}</div>
                    <div class="stat-card-value">${stat.value}</div>
                    ${stat.change ? `<div class="stat-card-change ${stat.positive ? 'positive' : 'negative'}">${stat.change} this quarter</div>` : ''}
                </div>
            `).join('');
        }

        function loadActiveDeals() {
            const container = document.getElementById('activeDealsContainer');
            if (!container) return;

            const activeDeals = PortalUtils.getUserDeals();

            if (activeDeals.length === 0) {
                PortalUtils.showEmpty('activeDealsContainer', 'No Active Investments', 'You haven\'t invested in any deals yet. Browse available opportunities to get started.', 'briefcase');
                return;
            }

            container.innerHTML = activeDeals.slice(0, 2).map(deal => PortalUtils.renderDealCard(deal)).join('');
        }

        function loadAvailableDeals() {
            const container = document.getElementById('availableDealsContainer');
            if (!container) return;

            const availableDeals = PortalUtils.getDeals()
                .filter(deal => deal.status === 'active' && !deal.userInvested)
                .slice(0, 2);

            if (availableDeals.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: var(--color-light-gray); padding: 40px 20px;">No new opportunities available at this time.</p>';
                return;
            }

            container.innerHTML = availableDeals.map(deal => PortalUtils.renderDealCard(deal)).join('');
        }

        function loadRecentActivity() {
            const container = document.getElementById('activityList');
            if (!container) return;

            const activities = PortalUtils.getActivityLog().slice(0, 5);

            if (activities.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: var(--color-light-gray); padding: 40px 20px;">No recent activity</p>';
                return;
            }

            container.innerHTML = activities.map(activity => PortalUtils.renderActivityItem(activity)).join('');
        }
    </script>
</body>
</html>
